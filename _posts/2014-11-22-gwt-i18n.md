---
layout: post
title: GWT i18n using UiBinder, gwt-maven-plugin and mergelocales.py
---

22 NOVEMBER 2014
Using Philippe Beaudoin‘s mergelocales.py script, GWT internationalization using UiBinder is made fairly easy. GWT i18n using UiBinder can quickly grow out of control, since the GWT compiler will duplicate all your translations across a bunch of properties files. Each file generated by the compiler will contain all your app’s translatable snippets, creating pointless duplication.
After this tutorial, you’ll be able to filter out the important parts of each properties file generated by the GWT compiler and to merge them (using mergelocales.py) into per-language, centralized, easy to maintain properties files.
mergelocale.py allows you to easily centralize all your translations Let’s say I have a UiBinder file that I want to translate:
<ui:UiBinder xmlns:ui='urn:ui:com.google.gwt.uibinder'  
             xmlns:g='urn:import:com.google.gwt.user.client.ui'
             xmlns:widgets='urn:import:com.arcbees.i18nsample.client.application.ui'>
    <g:HTMLPanel>
        <widgets:HelloWorldWidget/>
        <h1>Welcome to the i18n sample</h1>
        <p>This is an awesome i18n tutorial</p>
    </g:HTMLPanel>
</ui:UiBinder>  


And a widget (HelloWorldWidget) that needs translation too:
<ui:UiBinder xmlns:ui='urn:ui:com.google.gwt.uibinder'  
             xmlns:g='urn:import:com.google.gwt.user.client.ui'>
    <g:HTMLPanel>
        Hello, world!
    </g:HTMLPanel>
</ui:UiBinder>  


First of all, we need to add a few lines in the ui:UiBinder tag:
<ui:UiBinder xmlns:ui='urn:ui:com.google.gwt.uibinder'  
 xmlns:g='urn:import:com.google.gwt.user.client.ui'
 ui:generateFormat='com.google.gwt.i18n.rebind.format.PropertiesFormat'
 ui:generateKeys="com.google.gwt.i18n.rebind.keygen.MD5KeyGenerator"
 ui:generateLocales="default">


Second, we wrap the translatable text with ui:msg tags. Our two UiBinder files will look like:
<ui:UiBinder xmlns:ui='urn:ui:com.google.gwt.uibinder'  
             xmlns:g='urn:import:com.google.gwt.user.client.ui'
             xmlns:widgets='urn:import:com.arcbees.i18nsample.client.application.ui'
             ui:generateFormat='com.google.gwt.i18n.rebind.format.PropertiesFormat'
             ui:generateKeys="com.google.gwt.i18n.rebind.keygen.MD5KeyGenerator"
             ui:generateLocales="default">
    <g:HTMLPanel>
        <widgets:HelloWorldWidget/>
        <h1><ui:msg description="title">Welcome to the i18n sample</ui:msg></h1>
        <p><ui:msg description="paragraph">This is an awesome i18n tutorial</ui:msg></p>
    </g:HTMLPanel>
</ui:UiBinder>  


And
<ui:UiBinder xmlns:ui='urn:ui:com.google.gwt.uibinder'  
             xmlns:g='urn:import:com.google.gwt.user.client.ui'
             ui:generateFormat='com.google.gwt.i18n.rebind.format.PropertiesFormat'
             ui:generateKeys="com.google.gwt.i18n.rebind.keygen.MD5KeyGenerator"
             ui:generateLocales="default">
    <g:HTMLPanel>
         <ui:msg description="hello world greeting">Hello, world!</ui:msg>
    </g:HTMLPanel>
</ui:UiBinder>  


Note the description="title" , description="paragraph" and description="hello world greeting" attributes. These can be considered as the unique identifier of the strings you want to translate.
Now that our UiBinders are ready for translation, we need to generate the auxiliary extra files. Have a look at my gwt-maven-plugin configuration below:
<plugin>  
    <groupId>org.codehaus.mojo</groupId>
    <artifactId>gwt-maven-plugin</artifactId>
    <version>${gwt.version}</version>
    <configuration>
        <bindAddress>localhost</bindAddress>
        <runTarget>i18nSample.html</runTarget>
        <extraJvmArgs>-Xmx1024m -Xss1024k -XX:MaxPermSize=512m</extraJvmArgs>
        <extraParam>true</extraParam>
        <extra>extras</extra>
    </configuration>
    <executions>
        <execution>
            <phase>prepare-package</phase>
            <goals>
                <goal>compile</goal>
            </goals>
        </execution>
    </executions>
</plugin>  


The <extraParam> tag tells the GWT compiler that we want to generate the extra auxiliary files, and the <extra> tag instructs the GWT compiler to dump these files in a folder aptly named extras
In order to generate extra files, simply compile your application:
mvn clean gwt:compile  


The generated extra files will be found at the root of your project. The extras folder will contain a subfolder named by your module:
{your project's root folder}/extras/{the gwt module's name}


For me, the auxiliary files are under
~/i18n_sample/extras/i18nSample


Inside the extras folder, you’ll find one generated properties file per UiBinder file. Since in this example we have 2 UiBinder files, we’ll find 2 propertiesfiles:
1) com.arcbees.i18nsample.client.application.ApplicationViewBinderImplGenMessages.properties
# Generated from com.arcbees.i18nsample.client.application.ApplicationViewBinderImplGenMessages
# for locale en

6CD3556DEB0DA54BCA060B4C39479839=Hello, world\!

# Description: paragraph
83852BA80C9EA598F1B9F30A036D2D87=This is an awesome i18n tutorial

# Description: title
E58A0C08B55B63A3084A88D47B416D7D=Welcome to the i18n sample  


2) com.arcbees.i18nsample.client.application.ui.HelloWorldWidgetHelloWorldWidgetUiBinderImplGenMessages.properties
# Generated from com.arcbees.i18nsample.client.application.ui.HelloWorldWidgetHelloWorldWidgetUiBinderImplGenMessages
# for locale en

# Description: hello world greeting
6CD3556DEB0DA54BCA060B4C39479839=Hello, world\!

83852BA80C9EA598F1B9F30A036D2D87=This is an awesome i18n tutorial

E58A0C08B55B63A3084A88D47B416D7D=Welcome to the i18n sample  


You might notice that every translatable text snippet (for instance, “Hello, world!”, “This is an awesome i18n tutorial” and “Welcome to the i18n sample”) is duplicated across the generated properties files. Also, the descriptions are scattered across the many generated properties files. As your number of UiBinder files grows, you can imagine the complexity of managing all those snippets for each language of your application.
Suppose I want to make my app available in both English and French. I’d like also to manage only 2 files: one file containing the English snippets, and another file containing the French snippets. That’s where the mergelocales.py script comes in handy. This script will look for all your generated *.properties files and merge them into centralized, language-specific properties files.
Let’s get started. First of all, we need to create a LocalizableResource.properties file and a LocalizableResource_fr.propertiesfile. Both files should be empty. The LocalizableResource.properties will contain the default (English) snippets, whereas the LocalizableResource_fr.properties will contain the French snippets. In order for these files to be detected by GWT, we’ll need to put them in a resource/com/google/gwt/i18n/client folder.
Let’s populate those properties files! We need to invoke the mergelocales.pyscript:
python mergelocales.py extras/i18nSample src/main/resources/com/google/gwt/i18n/client/  


The first parameter (extras/i18nSample) tells the script where to find the *.properties files generated by GWT. The second parameter (src/main/resources/com/google/gwt/i18n/client/) tells the script where to dump the centralized translations.
Here’s a look at the populated LocalizableResource.properties file:
# Description: title
E58A0C08B55B63A3084A88D47B416D7D=Welcome to the i18n sample

# Description: paragraph
83852BA80C9EA598F1B9F30A036D2D87=This is an awesome i18n tutorial

# Description: hello world greeting
6CD3556DEB0DA54BCA060B4C39479839=Hello, world\!

### NON-UIBINDER TRANSLATIONS


and the populated LocalizableResource_fr.properties file:
# Description: hello world greeting
# TODO: TRANSLATE
6CD3556DEB0DA54BCA060B4C39479839=Hello, world\!

# Description: paragraph
# TODO: TRANSLATE
83852BA80C9EA598F1B9F30A036D2D87=This is an awesome i18n tutorial

# Description: title
# TODO: TRANSLATE
E58A0C08B55B63A3084A88D47B416D7D=Welcome to the i18n sample

### NON-UIBINDER TRANSLATIONS


You will notice that both files contain almost the same text, save for the #TODO: TRANSLATE comments found in the French properties file. Now, I can easily translate the LocalizableResource_fr.properties file:
# Description: hello world greeting
6CD3556DEB0DA54BCA060B4C39479839=Bonjour, le monde\!

# Description: paragraph
83852BA80C9EA598F1B9F30A036D2D87=Un tutorial super sur i18n

# Description: title
E58A0C08B55B63A3084A88D47B416D7D=Bienvenue dans l'example i18n

### NON-UIBINDER TRANSLATIONS


That’s it! My app is translated. Now, we must add locale choices to our module XML:
<!-- French language, independent of country -->  
<extend-property name="locale" values="fr" />  
<!-- English language, independent of country -->  
<extend-property name="locale" values="en" />  
<set-property-fallback name="locale" value="en" />  


To load the French version of the app, we must specify the French locale query string: http://www.example.org/myapp.html?locale=fr
By default, the application will be shown in English, so loadinghttp://www.example.org/myapp.html orhttp://www.example.org/myapp.html?locale=en will have the same result.
You can find the source code for this tutorial in ArcBees’ GitHub repo.
